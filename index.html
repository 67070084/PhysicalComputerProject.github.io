<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OIIA Spinner Project</title>
  <style>
    body {
      font-family: "Sarabun", sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
      line-height: 1.7;
      color: #333;
    }
    header {
      background-color: #0078D7;
      color: white;
      padding: 25px;
      text-align: center;
    }
    section {
      max-width: 900px;
      margin: 40px auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    h2 {
      color: #0078D7;
      border-bottom: 2px solid #0078D7;
      padding-bottom: 5px;
      margin-top: 0;
    }
    ul {
      list-style: disc;
      margin-left: 20px;
    }
    li {
      margin-bottom: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #e9ecef;
    }
    pre {
      background-color: #f0f0f0;
      padding: 15px;
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    footer {
      text-align: center;
      padding: 20px;
      color: #555;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <header>
    <h1>OIIA Spinner</h1>
    <p>ระบบควบคุมแมวหมุนผ่าน Wi-Fi ด้วย Arduino UNO R4 WiFi</p>
  </header>

  <section>
    <h2>Abstract / บทคัดย่อ</h2>
    <p>
      OIIA Spinner Project พัฒนาระบบควบคุมการหมุนของแมว (ตัวอย่างวิดีโอที่เลือก) 
      ผ่าน Wi-Fi โดยใช้ Arduino UNO R4 WiFi เป็นตัวควบคุมหลัก 
      ผู้ใช้สามารถควบคุมผ่านหน้าเว็บและปุ่มจริงบนบอร์ด ระบบส่งข้อมูลแบบ JSON 
      เพื่อซิงค์สถานะระหว่างเว็บและฮาร์ดแวร์ 
      โครงงานนี้มุ่งเน้นการเรียนรู้การทำ Web Server บนไมโครคอนโทรลเลอร์ 
      และการเชื่อมต่อระหว่างฮาร์ดแวร์กับอินเทอร์เฟซบนเว็บ
    </p>
  </section>

  <section>
    <h2>1. ทำอะไรมา</h2>
    <p><strong>ฝั่ง Arduino:</strong></p>
    <ul>
      <li>ใช้บอร์ด Arduino UNO R4 WiFi</li>
      <li>เชื่อมต่อ Wi-Fi ด้วยไลบรารี <code>WiFiS3.h</code></li>
      <li>สร้าง Web Server บนพอร์ต 80</li>
      <li>ตอบสนองคำสั่ง <code>/status</code> ส่งสถานะปุ่ม 4 ปุ่ม (Run, Stop, Speed, Reset) เป็น JSON</li>
      <li>ส่งหน้าเว็บ HTML ให้ผู้ใช้เมื่อเข้าผ่าน IP ของบอร์ด</li>
    </ul>

    <p><strong>ฝั่งเว็บ (HTML + JavaScript):</strong></p>
    <ul>
      <li>เก็บ HTML, CSS, JavaScript ในตัวแปร <code>INDEX_HTML</code> (ไฟล์ <code>webpage.h</code>)</li>
      <li>แสดงวิดีโอแมวหมุน พร้อมตัวจับเวลาและปุ่มควบคุม 4 ปุ่ม</li>
      <li>ใช้ JavaScript สั่งเล่น/หยุด/ปรับความเร็วของวิดีโอ</li>
      <li>เรียก <code>fetch("/status")</code> ทุก 0.5 วินาที เพื่อตรวจสอบปุ่มจริงและซิงค์กับเว็บ</li>
    </ul>
  </section>

  <section>
    <h2>2. อุปสรรคที่พบ และวิธีแก้ไข</h2>
    <ul>
      <li>WiFi ต่อไม่ติด / เว็บเข้าไม่ได้ → ตรวจสอบ SSID, Password และรอจน <code>WL_CONNECTED</code> ก่อนเริ่ม server</li>
      <li>หน้าเว็บโหลดไม่ขึ้น → เพิ่ม header HTTP ครบ <code>HTTP/1.1 200 OK, Content-Type</code></li>
      <li>กดปุ่มแล้วเว็บไม่ตอบสนอง → ตรวจสอบ <code>client.flush()</code> และ <code>client.stop()</code></li>
      <li>ปุ่มกดไม่ตอบสนอง → ตรวจสอบ <code>pinMode()</code> ของทุกปุ่ม และ debounce</li>
      <li>ความเร็วการตอบสนองช้า → ลด delay และเพิ่มตรวจสอบสถานะภายใน loop</li>
      <li>ควบคุม GIF ไม่ได้ → เปลี่ยนจาก GIF เป็นวิดีโอ</li>
      <li>วิดีโอใหญ่เกินอัปโหลดบอร์ด → อัปโหลดวิดีโอบน GitHub แล้วใช้ URL แทน</li>
    </ul>
  </section>

  <section>
    <h2>3. ผลลัพธ์ที่ได้ตอนนี้</h2>
    <ul>
      <li>✅ ควบคุมการหมุนของแมวผ่านปุ่มบนบอร์ดและหน้าเว็บได้</li>
      <li>✅ ปุ่มจริงบนบอร์ดทำงานเหมือนปุ่มบนเว็บ</li>
      <li>✅ ซิงค์สถานะเรียลไทม์ระหว่าง Arduino และเว็บ</li>
      <li>✅ ระบบรีเซ็ตและปรับความเร็วได้</li>
    </ul>
  </section>

  <section>
    <h2>4. สิ่งที่ยังทำไม่ได้</h2>
    <ul>
      <li>เชื่อมต่อกับเครือข่ายที่มีการเข้ารหัสซับซ้อน เช่น WiFi_UFO ของมหาวิทยาลัย</li>
    </ul>
  </section>

  <section>
    <h2>5. บทบาทของสมาชิกในโครงงาน</h2>
    <table>
      <tr><th>รหัสนักศึกษา</th><th>ชื่อ - สกุล</th><th>หน้าที่</th></tr>
      <tr>
        <td>67070036</td>
        <td>นายชัชพิสิฐ บุนนาค</td>
        <td>ทำโค้ดส่วน Arduino / Poster</td>
      </tr>
      <tr>
        <td>67070084</td>
        <td>นายธีรัตม์ สถาพรวณิชย์</td>
        <td>ทำโค้ดส่วน Arduino + HTML / GitHub.io</td>
      </tr>
      <tr>
        <td>67070128</td>
        <td>นายภาคภูมิ นพเก้า</td>
        <td>ทำโค้ดส่วน HTML / GitHub.io / ตัดต่อคลิป</td>
      </tr>
    </table>
  </section>

  <section>
    <h2>6. Source Code ตัวอย่าง</h2>
    <p>Arduino:</p>
    <pre>
// Arduino OIIA Spinner
#include &lt;WiFiS3.h&gt;
#include "webpage.h"

char ssid[] = "Muka_WiFi";
char pass[] = "13042505A";
WiFiServer server(80);

const int pinReset = 4;
const int pinSpeed = 5;
const int pinStop  = 6;
const int pinRun   = 7;

void setup() {
  Serial.begin(9600);
  pinMode(pinReset, INPUT);
  pinMode(pinSpeed, INPUT);
  pinMode(pinStop, INPUT);
  pinMode(pinRun, INPUT);

  WiFi.begin(ssid, pass);
  while(WiFi.status() != WL_CONNECTED){ delay(1000); }

  server.begin();
}

void loop() {
  WiFiClient client = server.available();
  if(client){
    String req = client.readStringUntil('\\r');
    client.flush();
    if(req.indexOf("GET /status") >= 0){
      client.println("HTTP/1.1 200 OK");
      client.println("Content-Type: application/json");
      client.println();
      client.print("{\"run\":" + String(digitalRead(pinRun)) +
                   ",\"stop\":" + String(digitalRead(pinStop)) +
                   ",\"speed\":" + String(digitalRead(pinSpeed)) +
                   ",\"reset\":" + String(digitalRead(pinReset)) + "}");
    }else{
      client.println("HTTP/1.1 200 OK");
      client.println("Content-Type: text/html");
      client.println();
      client.println(INDEX_HTML);
    }
    client.stop();
  }
  delay(500);
}
    </pre>

    <p>Webpage.h:</p>
    <pre>
#ifndef WEBPAGE_H
#define WEBPAGE_H

const char INDEX_HTML[] = R"rawliteral(
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OIIA Spinner</title>
    <style>
        /* Reset */
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to right, #fbc2eb, #a6c1ee);
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            margin-bottom: 20px;
            color: #333;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .card {
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            text-align: center;
            width: 280px;
        }

        video {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        #timer, #status {
            font-size: 18px;
            margin: 10px 0;
            color: #555;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-run { background-color: #4CAF50; color: white; }
        .btn-stop { background-color: #f44336; color: white; }
        .btn-speed { background-color: #ff9800; color: white; }
        .btn-reset { background-color: #2196F3; color: white; }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <h1>OIIA Spinner</h1>
    <div class="card">
        <video id="catGif" loop muted playsinline>
            <source src="https://67070084.github.io/Physic-computer-Project/oia-uia-ezgif.com-gif-to-mp4-converter.mp4" type="video/mp4">
        </video>
        <div id="timer">00:00:00</div>
        <div id="status">Cat stopped</div>
        <div>
            <button class="btn btn-run" onclick="runCat()">Run</button>
            <button class="btn btn-stop" onclick="stopCat()">Stop</button>
            <button class="btn btn-speed" onclick="speedUp()">Speed Up</button>
            <button class="btn btn-reset" onclick="resetCat()">Reset</button>
        </div>
    </div>

    <script>
        let running = false;
        let seconds = 0;
        let timerInterval;
        let speedLevel = 1;
        const catGif = document.getElementById("catGif");

        function updateTimer() {
            seconds++;
            let hrs = String(Math.floor(seconds / 3600)).padStart(2,'0');
            let mins = String(Math.floor((seconds % 3600) / 60)).padStart(2,'0');
            let secs = String(seconds % 60).padStart(2,'0');
            document.getElementById("timer").innerText = `${hrs}:${mins}:${secs}`;
        }

        function runCat() {
            if (!running) {
                running = true;
                document.getElementById("status").innerText = "Cat running";
                catGif.play().catch(err => console.log("Video play blocked:", err));
                timerInterval = setInterval(updateTimer, 1000);
            }
        }

        function stopCat() {
            if (running) {
                running = false;
                document.getElementById("status").innerText = "Cat stopped";
                catGif.pause();
                clearInterval(timerInterval);
            }
        }

        function speedUp() {
            if (running) {
                speedLevel++;
                if (speedLevel > 3) speedLevel = 1;
                catGif.playbackRate = speedLevel;
                document.getElementById("status").innerText = "Speed x" + speedLevel;
            }
        }

        function resetCat() {
            running = false;
            clearInterval(timerInterval);
            seconds = 0;
            document.getElementById("timer").innerText = "00:00:00";
            document.getElementById("status").innerText = "Cat reset";
            catGif.pause();
            catGif.currentTime = 0;
            speedLevel = 1;
            catGif.playbackRate = 1;
        }

        // Polling Arduino ปุ่มทุก 0.5 วินาที
        setInterval(() => {
            fetch("/status")
            .then(response => response.json())
            .then(data => {
                if (data.run) runCat();
                if (data.stop) stopCat();
                if (data.speed) speedUp();
                if (data.reset) resetCat();
            })
            .catch(err => console.log("Fetch error:", err));
        }, 500);
    </script>
</body>
</html>
)rawliteral";

#endif

    </pre>
  </section>

  <footer>
    จัดทำโดย นักศึกษามหาวิทยาลัยพระจอมเกล้าลาดกระบัง<br>
    © 2025 OIIA Spinner Project
  </footer>

</body>
</html>
